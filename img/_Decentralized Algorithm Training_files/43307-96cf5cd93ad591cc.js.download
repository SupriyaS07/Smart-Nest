"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[43307],{14203:(e,t,i)=>{i.d(t,{A:()=>g});var n=i(43453),l=i(98505),r=i(72623),o=i(34188),s=i(77339),u=i(64360),a=i(19168),d=i(37967),c=i.n(d),_=i(80712),p=i(82245),m=i(65949),f=i(45420);let g=e=>{let{size:t="medium",user:i,showEdit:d,onChange:g,anon:v,altText:y,defaultIcon:h=u.X4,showProBadge:k,className:b,proBadgeClassName:w}=e,x="xs";"medium"===t?x="1x":"large"===t&&(x="2x");let E=(0,l.useCallback)(()=>{let e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{var t;let i=null===(t=e.target.files)||void 0===t?void 0:t[0];if(i){let e=new FileReader;e.onload=e=>{var t;g&&g(null===(t=e.target)||void 0===t?void 0:t.result)},e.readAsDataURL(i)}},e.click()},[g]);return(0,n.jsx)("div",{className:c()("relative",b),children:(0,n.jsxs)(_.Ay,{variant:"offsetPlus",className:c()("relative flex aspect-square shrink-0 items-center justify-center rounded-full",{"h-3 w-3":"tiny"===t,"h-5 w-5":"small"===t,"h-6 w-6":"base"===t,"h-8 w-8":"medium"===t,"w-[80px]":"large"===t,"ring-super dark:ring-superDark border-2 border-transparent ring-[1.5px]":k}),children:[i&&!v?(0,n.jsx)("img",{alt:null!=y?y:"User avatar",className:"h-full w-full rounded-full object-cover",src:i}):(0,n.jsx)(p.A,{color:"light",children:(0,n.jsx)(r.g,{size:x,icon:v?a.Lk:h,fixedWidth:!0})}),d&&"small"!==t&&(0,n.jsx)("div",{className:"absolute bottom-0 right-0",children:(0,n.jsx)(m.A,{ariaLabel:"Edit avatar",variant:i?"common":"primary",size:"small",pill:!0,icon:i?o.faPenToSquare:s.QL,onClick:E})}),k&&(0,n.jsx)("div",{className:c()("bg-offset absolute top-full -mt-[6px] w-[24px] rounded-r-full p-[1.5px]",{"opacity-0":"small"===t},{"w-lg -mt-[10px]":"large"===t},w),children:(0,n.jsx)(f.C,{fillColor:"fill-super",width:"w-full",sizeVariant:"small"})})]})})}},93955:(e,t,i)=>{i.d(t,{Hh:()=>n,Ox:()=>r,d8:()=>l});let n=["list_user_collections",{}],l="list_collection_threads",r="__temp__"},27299:(e,t,i)=>{i.d(t,{p:()=>l});var n=i(66877);let l=()=>{var e,t;let{organization:i}=(0,n.f)();return null!==(t=null==i?void 0:null===(e=i.settings)||void 0===e?void 0:e.disabled_model_preferences)&&void 0!==t?t:[]}},49967:(e,t,i)=>{i.d(t,{W:()=>n,j:()=>l});let n=20,l="list_ask_threads"},47303:(e,t,i)=>{i.d(t,{A:()=>w});var n=i(43453),l=i(98505),r=i(70701),o=i(96761),s=i(76053),u=i(61323),a=i(51599),d=i(94039),c=i(58269),_=i(67113),p=i(46320),m=i(90374),f=i(43695),g=i(69634),v=i(49745),y=i(14203),h=i(66877),k=i(34025),b=i(83358);let w=()=>{let e=(0,r.useTranslations)("askInput.assistants"),{isEnterprise:t,organization:i}=(0,h.f)(),w=null==i?void 0:i.logo,x=null==i?void 0:i.display_name,E=(0,k.c)(),{isLocalhost:A,isTesting:C}=(0,g.D)(),{institution:T}=(0,b.T)();return{DEFAULT_ASSISTANTS:(0,l.useMemo)(()=>{let e=new Set(["internet","scholar","wolfram","writing","youtube","reddit"]);return(null==T?void 0:T.focusable)&&e.add("institution"),E&&(A||C)&&e.add("recruiter"),e},[E,A,C,null==T?void 0:T.focusable]),FocusConfigs:(0,l.useMemo)(()=>{let i=w?(0,n.jsx)(y.A,{user:w,size:"small"}):void 0;return{[v.Fb.internet]:{icon:p.Bw,text:e("internetTitle"),info:e("internetDescription")},[v.Fb.scholar]:{icon:d.GL,text:e("scholarTitle"),info:e("scholarDescription")},[v.Fb.writing]:{icon:m.zL,text:e("writingTitle"),info:e("writingDescription")},[v.Fb.wolfram]:{icon:a.gV,text:e("wolframTitle"),info:e("wolframDescription")},[v.Fb.youtube]:{icon:_.qt,text:e("videoTitle"),info:e("videoDescription")},[v.Fb.reddit]:{icon:c.Qu,text:e("redditTitle"),info:e("redditDescription")},[v.Fb.recruiter]:{icon:o.u4,text:e("recruiterTitle"),info:e("recruiterDescription")},...(null==T?void 0:T.focusable)?{[v.Fb.institution]:{icon:f.y_,text:T.name,info:e("institutionDescription",{institution:T.name})}}:{},[v.wp.space]:{icon:s.A4,text:e("spaceTitle"),info:e("spaceDescription")},...t?{[v.wp.team]:{icon:u.US,avatar:i,text:null!=x?x:e("teamTitle"),info:e("teamDescription")}}:{}}},[e,w,T,t,x])}}},96298:(e,t,i)=>{i.d(t,{t:()=>u});var n=i(86252),l=i(65857),r=i(8682),o=i(86257),s=i(36398);let u=()=>{let e=(0,n.useQueryClient)(),t=(0,o.U_)(),{mutate:i}=(0,l.useMutation)({mutationFn:async e=>{await (0,r.uT)({settings:e})},onMutate:async i=>{await e.cancelQueries({queryKey:t});let n=e.getQueryData(t),l={};for(let e in i)l[s.qZ[e]]=i[e];return e.setQueryData(t,e=>({...e,...l})),{previousSettings:n}},onSettled(i,n,l,r){n&&e.setQueryData(t,null==r?void 0:r.previousSettings)}});return{updateSettings:i}}},61890:(e,t,i)=>{i.d(t,{T:()=>o});var n=i(44772),l=i(79827),r=i(48197);let o=e=>{var t,i,o;let{response:s,socket:u,queryClient:a,trackEvent:d}=e;if(u&&r.sV.endStreamResponse(),!s.frontend_context_uuid&&!n.i.isStatusFailed(s)){l.v.error(Error("No frontend_context_uuid found in response"));return}let c=null===(o=s.blocks.find(e=>"knowledge_cards"===e.intended_usage))||void 0===o?void 0:null===(i=o.knowledge_card_block)||void 0===i?void 0:null===(t=i.knowledge_cards)||void 0===t?void 0:t[0];c&&d&&d("knowledge card in results",{entryUUID:s.backend_uuid,name:c.title,id:c.id,type:c.card_type}),a.setQueryData(["results"],e=>{if(!e)return;let t=e.map(e=>null==e?void 0:e.backend_uuid).includes(null==s?void 0:s.backend_uuid),i=e.map(e=>null==e?void 0:e.uuid).includes(null==s?void 0:s.uuid),n=e.map(e=>{if((null==e?void 0:e.uuid)!==(null==s?void 0:s.uuid)&&(null==e?void 0:e.backend_uuid)!==(null==s?void 0:s.backend_uuid))return e;{let t={author_id:s.author_id,author_username:s.author_username,author_image:s.author_image,final:s.final,status:s.status,step_type:s.step_type,related_queries:s.related_queries,related_query_items:s.related_query_items,display_model:s.display_model,sponsored_results:s.sponsored_results,expect_sponsored_results:s.expect_sponsored_results,read_write_token:s.read_write_token,thread_url_slug:s.thread_url_slug,thread_title:s.thread_title,thread_access:s.thread_access,updated_datetime:s.updated_datetime,expiry_time:s.expiry_time,privacy_state:s.privacy_state,prompt_source:s.prompt_source,query_source:s.query_source,form:s.form};return{...e,...t,blocks:s.blocks,message_mode:s.message_mode}}});if(t||i)return n})}},80828:(e,t,i)=>{i.d(t,{Z:()=>a});var n=i(44772),l=i(79827),r=i(83612),o=i(48197),s=i(36545),u=i(36398);let a=e=>{let{response:t,queryClient:i,socket:a,session:d}=e;if(!t||!n.i.isStatusPending(t))return;let c=i.getQueryData(["results"]);if((null==c?void 0:c[0].backend_uuid)===s.d&&i.setQueryData(["results"],e=>e.map(e=>({...e,uuid:t.uuid,frontend_context_uuid:t.frontend_context_uuid,backend_uuid:t.backend_uuid}))),(null==c?void 0:c[0].frontend_context_uuid)!==t.frontend_context_uuid)return;let _=null==t?void 0:t.uuid,p=null==t?void 0:t.frontend_context_uuid;_||p||l.v.error("[handleProgressResponse]",Error("no uuid and no frontend_context_uuid in response=".concat(t)));let m=t.blocks.some(e=>{var t;return(null==e?void 0:null===(t=e.markdown_block)||void 0===t?void 0:t.chunks)&&e.markdown_block.chunks.length>0}),f=t.blocks.some(e=>{var t;return(null==e?void 0:null===(t=e.web_result_block)||void 0===t?void 0:t.web_results)&&e.web_result_block.web_results.length>0});void 0!=a&&o.sV.handleStreamProgress(a,d,m,f),i.setQueryData(["results"],e=>e?e.map(e=>{if((null==e?void 0:e.uuid)===(null==t?void 0:t.uuid)&&t.message_mode===r.B3.STREAMING&&t.blocks){let i=e.blocks||[],n=(0,u.pw)(i,t.blocks);return{...e,blocks:n,status:t.status,message_mode:t.message_mode,expect_search_results:t.expect_search_results,should_upsell_pro:t.should_upsell_pro,related_queries:t.related_queries,backend_uuid:t.backend_uuid,frontend_context_uuid:t.frontend_context_uuid,context_uuid:t.context_uuid,uuid:t.uuid,widget_data:t.widget_data,widget_intents:t.widget_intents,text_completed:t.text_completed,knowledge_cards:t.knowledge_cards,expect_sponsored_results:t.expect_sponsored_results,related_query_items:t.related_query_items,reasoning_plan:t.reasoning_plan,is_pro_reasoning_mode:t.is_pro_reasoning_mode,num_sources_display:t.num_sources_display,display_model:t.display_model,answer_modes:t.answer_modes,structured_answer_block_usages:t.structured_answer_block_usages}}return e}):[])}},29190:(e,t,i)=>{i.d(t,{t:()=>l});var n=i(83612);let l=e=>{let{response:t,queryClient:i}=e;i.setQueryData(["shopping_results",t.backend_uuid],e=>e?e.map(e=>{if((null==e?void 0:e.url)===(null==t?void 0:t.id)&&t.blocks&&t.blocks[0].shopping_block){if(t.message_mode===n.B3.STREAMING){var i;return{...e,meta_data:{...e.meta_data,review_summary:{...null!==(i=e.meta_data.review_summary)&&void 0!==i?i:{summary:"",review_quality_score:0,pros_detailed:[],cons_detailed:[],pros:[],cons:[],key_features:[],buy_if:"",review_search_results:[]},...Object.fromEntries(Object.entries(t.blocks[0].shopping_block).filter(e=>{let[t,i]=e;return!(null==i||Array.isArray(i)&&0===i.length)&&("number"!=typeof i||0!==i)&&("string"!=typeof i||""!==i)}))}}}}if(t.message_mode===n.B3.FULL)return{...e,meta_data:{...e.meta_data,review_summary:t.blocks[0].shopping_block}}}return e}):[])}},87347:(e,t,i)=>{i.d(t,{B:()=>en,N:()=>el});var n=i(43453),l=i(98505),r=i(86252),o=i(1785),s=i(70701),u=i(45920),a=i(20605),d=i(82940),c=i(44772),_=i(43e3),p=i(68876),m=i(83401),f=i(67522),g=i(54188),v=i(79827),y=i(83612),h=i(64493),k=i(93955),b=i(24674),w=i(49967),x=i(48197),E=i(6439),A=i(34025),C=i(96298),T=i(92455),S=i(8682),L=i(31741),D=i(69577),R=i(31780),I=i(54329),O=i(26269).Buffer;let N=(e,t)=>t.find(t=>t.url===("string"==typeof e?e:e.url)),P=e=>{var t;let{inPage:i}=e;return i?null===(t=window.getSelection())||void 0===t?void 0:t.toString():void 0},M=e=>{var t;let{inPage:i,renderingPlace:n,browserContext:l}=e;if(!l)return;let r=l.tabs.map(e=>{let t={lastAccessed:e.lastAccessed,...e.metadata&&{...Object.fromEntries(Object.entries(e.metadata).filter(e=>{let[t]=e;return"knnContentScores"!==t})),...e.metadata.knnContentScores&&{knnContentScores:[...e.metadata.knnContentScores]}}};return{url:e.url,title:e.title,content:e.markdown?[e.markdown.slice(0,3e4)]:[],content_type:"markdown",content_origin:e.active?"current_tab":"open_tab",...e.ogMetadataTitle?{og_title:e.ogMetadataTitle}:{},...e.ogMetadataDescription?{og_description:e.ogMetadataDescription}:{},...e.lastAccessed?{last_visit_ts:Math.floor(e.lastAccessed/1e3)}:{},metadata:t}});if("sidecar"===n){let e=r.find(e=>"current_tab"===e.content_origin);return e?[e]:[]}if(i){let e=N(i,r);return e?[e]:[]}let o=new Set(r.map(e=>e.url)),s=null===(t=l.related)||void 0===t?void 0:t.map(e=>({url:e.url,title:e.title,content:e.markdown?[e.markdown.slice(0,3e4)]:[],content_type:"markdown",content_origin:"history",...e.ogMetadataTitle?{og_title:e.ogMetadataTitle}:{},...e.ogMetadataDescription?{og_description:e.ogMetadataDescription}:{},...e.lastAccessed?{last_visit_ts:Math.floor(e.lastAccessed/1e3)}:{},metadata:e.metadata})).filter(e=>!o.has(e.url));return[...r,...null!=s?s:[]]},q=async e=>{let{query:t,inPage:i,clientPayloadCacheKey:n,entropyBrowser:l}=e;if(l)try{let e=await l.getContext({query:t}),r=M({inPage:i,renderingPlace:l.getRenderingPlace(),browserContext:e}),o=l.getNavigationResults(),s=await (0,I.ND)({urlPath:"/rest/browser/client_payload",method:"POST",body:JSON.stringify({client_payload_cache_key:n,client_context:r||[],client_navigation:o||[]}),headers:{"Content-Type":"application/json"}});if(200!==s.status)throw Error("Failed to send client payload");if(r&&r.length>0){let e=function(e){let t={};function i(e){if(null==e)return 0;switch(typeof e){case"boolean":return 1;case"number":return 8;case"string":return O.byteLength(e,"utf8");default:return 0}}!function e(n){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(Array.isArray(n)){let r=0;for(let t of n)r+=i(t),t&&"object"==typeof t&&e(t,l);l&&(t[l]=(t[l]||0)+r)}else if(n&&"object"==typeof n)for(let r in n){if(!Object.prototype.hasOwnProperty.call(n,r))continue;let o=n[r],s=i(o),u=l||r;t[u]=(t[u]||0)+s,o&&"object"==typeof o&&e(o,u)}}(e);let n=Object.values(t).reduce((e,t)=>e+t,0);return t.total=n,t.numDocuments=n>0?Array.isArray(e)?e.length:1:0,t}(r);console.log("Client Context Size: ",e),e.total>0&&x.sV.reportClientContextSize(e)}e.diagnostics&&x.sV.reportClientPayload(e.diagnostics.dbSize,e.diagnostics.perfDbQueryTimeMs,e.diagnostics.perfGetContextTimeMs)}catch(e){v.v.error("Error sending client payload for cache key ",n,e)}};var U=i(99220),j=i(46955);let F=async e=>{try{let t=await fetch("".concat(window.location.origin,"/api/metrics/report-stream-time"),{method:"POST",body:JSON.stringify({startTime:e}),headers:{"content-type":"application/json"}});t.ok||v.v.error("Failed to report time");let{elapsedTime:i}=await t.json();v.v.log("Server-side streaming time: ".concat(i,"ms"))}catch(e){v.v.error("Error reporting time:",e)}},Q=e=>{let{isFollowup:t,existingFrontendContextUUID:i,firstResult:n}=e;return t&&void 0!==n&&void 0!==n.frontend_context_uuid&&i===n.frontend_context_uuid},V=e=>{let{defaultFocus:t,focusOverride:i,currentSources:n,isFollowup:l,existingFrontendContextUUID:r,firstResult:o,isAssistantSwitcher:s}=e;return!l&&i?i:Q({isFollowup:l,existingFrontendContextUUID:r,firstResult:o})&&o&&c.i.isFocusType(o.search_focus)?o.search_focus:s?t:(null==n?void 0:n.length)===0?"writing":"internet"},W=e=>{let{defaultSources:t,sourcesOverride:i,isFollowup:n,existingFrontendContextUUID:l,firstResult:r}=e;if(!n&&i)return i;if(Q({isFollowup:n,existingFrontendContextUUID:l,firstResult:r})&&r){var o,s;let e=null;if(e=null!==(s=null===(o=r.sources)||void 0===o?void 0:o.sources)&&void 0!==s?s:null,c.i.isSourceListType(e))return e}return t},z=e=>{let{recencyFromContext:t,isFollowup:i,existingFrontendContextUUID:n,firstResult:l}=e;if(!i)return t;if(Q({isFollowup:i,existingFrontendContextUUID:n,firstResult:l})&&l){var r;let e=null!==(r=l.search_recency_filter)&&void 0!==r?r:null;if(e&&"UNRECOGNIZED"!==e&&"RECENCY_TYPE_UNSPECIFIED"!==e)return e}return null},K=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,i=arguments.length>2?arguments[2]:void 0;return(null==e?void 0:e.connected)?Promise.resolve():new Promise((n,l)=>{let r=setTimeout(()=>{u();let e=performance.now();(0,x.k_)(e-i),n()},t),o=()=>{u();let e=performance.now();(0,x.k_)(e-i),n()},s=e=>{u(),l(e)},u=()=>{clearTimeout(r),null==e||e.off("connect",o),null==e||e.off("error",s)};null==e||e.on("connect",o),null==e||e.on("error",s)})};var B=i(51414),G=i(99878);let H=e=>{let{result:t,step:i,socket:n,user_id:l,lastEntryUUID:r,deviceLocation:o,queryClient:s,handleProgressResponse:u,handleFinalResponse:a}=e,d={...t,form_response:i};s.setQueryData(["results"],e=>e?e.map(e=>(null==e?void 0:e.uuid)===(null==t?void 0:t.uuid)?{...e,...d}:e):[]);let c=(0,U.cH)();null==n||n.on("query_progress",u),null==n||n.emit("perplexity_ask",t.query_str,{existing_entry_uuid:t.backend_uuid,last_backend_uuid:r,read_write_token:t.read_write_token,frontend_uuid:t.uuid,search_focus:t.search_focus,attachments:null==t?void 0:t.attachments,step_payload:i,device_location:o,frontend_context_uuid:t.frontend_context_uuid,visitor_id:c,user_nextauth_id:l},e=>{a(e)})};var J=i(61890),Z=i(80828),Y=i(29190),$=i(89708),X=i(68033);let ee=e=>{var t;let{socket:i,response:n,isUserLoggedIn:l,submissionCount:r,session:o,queryCountMobile:s,isProUser:u,locale:a,queryCount:d,addKeyRequiringRerender:_,getEppoBooleanVariation:p,setSubmissionCount:m,trackEvent:f,setShouldShowProductFeedback:v}=e;if(null==n?void 0:n.backend_uuid){let e=n.backend_uuid;(0,S.I3)(void 0,n.backend_uuid,{query:n.query_str||"",sources:n.sources}).then(t=>{v(t),t&&f("query feedback shown",{entry_uuid:e})})}l||1!==r||((0,X._b)(),_("floating-signup")),l&&(null==o?void 0:null===(t=o.user)||void 0===t?void 0:t.id)&&0===s&&9===r&&_("floating-mobile-download"),l&&!u&&a===g.Xn&&49===d&&p({flag:"pro-email-upsell",subjectType:"user_nextauth_id",defaultValue:!1}),m(r+1),!n||c.i.isStatusFailed(n)?i&&x.sV.failedResponse(n,i,o):i&&x.sV.successfulResponse(n,i,o)},et=(0,l.createContext)({submitQuery:()=>void 0,handleBotStep:()=>void 0,deleteLastResult:()=>void 0,shouldShowProductFeedback:!1}),ei=(e,t,i,n)=>e&&!t?void 0:i?i.backend_uuid:null==n?void 0:n.backend_uuid,en=e=>{let{children:t,shouldFetchSettings:i}=e,I=(0,r.useQueryClient)(),O=(0,L.X)(),N=(0,u.useRouter)(),M=(0,u.useSearchParams)(),{trackEvent:Q}=(0,x.yw)(),{data:X}=(0,o.useSession)(),en=(0,E.E)(),el=(0,s.useLocale)(),er=(0,B.Z)(),{location:eo}=(0,d.$)(),{focus:es,sources:eu,recency:ea,isAssistantSwitcher:ed,isCopilot:ec,setIsCopilot:e_,gpt4Limit:ep,setGPT4Limit:em,setProReasoningLimit:ef,setAskInputReasoningMode:eg,askInputReasoningModelPreference:ev,setAskInputReasoningModelPreference:ey}=(0,R.y)(),{firstResult:eh,lastResult:ek}=(0,D.E)(),eb=(0,D.$O)(),ew=(0,D.zD)(),{hasAiProfile:ex,defaultModel:eE,queryCount:eA,queryCountMobile:eC}=(0,T.u)(i),[eT,eS]=(0,l.useState)(!1),{updateSettings:eL}=(0,C.t)(),eD=null==ek?void 0:ek.backend_uuid,eR=(0,A.L)(),{addKeyRequiringRerender:eI,getEppoBooleanVariation:eO}=(0,G.wn)(),eN=(0,b.U)(),[eP,eM]=(0,l.useState)(0),eq=(0,l.useCallback)(e=>{e&&c.i.isStatusPending(e)&&(0,Z.Z)({response:e,queryClient:I,socket:O,session:X})},[I,O,X]);(0,l.useEffect)(()=>(null==O||O.on("query_progress",eq),null==O||O.on("shopping_review_summary_progress",eU),()=>{null==O||O.off("query_progress",eq),null==O||O.off("shopping_review_summary_progress",eU)}),[O]);let eU=(0,l.useCallback)(e=>{(0,Y.t)({response:e,queryClient:I})},[I]),ej=(0,l.useCallback)(e=>{(0,J.T)({response:e,socket:O,queryClient:I,trackEvent:Q})},[O,I,Q]),eF=(0,l.useCallback)(async e=>{var t,i,n,l,r,o,s,u,d;let{rawQuery:b,fork:E,inPageOverride:A,focusOverride:C,sourcesOverride:T,copilotOverride:L,existingEntryUUID:D,existingUuid:R,deletedUrls:N,redoSearch:B,attachments:G,collection:H,modelPreference:J,isRelatedQuery:Z,isSponsored:Y,relatedQueryUUID:et,inDomain:ew,inPage:eT,submitCallback:eD,newFrontendContextUUID:eq,existingFrontendContextUUID:eU,promptSource:eF,querySource:eQ,submitFromArticleOverride:eV,timeFromFirstType:eW,utmSource:ez,stepPayload:eK,preserveMessageState:eB,disableWidgets:eG,isNavSuggestionsDisabled:eH,requestReceivedTimestamp:eJ,deviceLocation:eZ}=e,eY=(eZ=null!=eZ?eZ:eo)?{location_lat:eZ.latitude,location_lng:eZ.longitude,name:""}:null,e$=b.trim();if(0===e$.length){v.v.error("Submit failed: empty query");return}if(!eR){let e=eP+1;e%6==0?eI("visitor-gate-ii"):e%3==0&&eI("visitor-gate")}let eX=!!eq,e0=(0,_._G)(),e1=(0,_._G)(),e4=[...new Set([...null!=G?G:[]])].slice(0,10).filter(e=>!(null==N?void 0:N.includes(e))),e3=null!=L?L:ec,e8=void 0!==J?J:ev,e9="r1"===e8||"o3mini"===e8,e2=e3?JSON.stringify([{step_type:"INITIAL_QUERY",content:{query:""},uuid:""}]):e4.length>0?JSON.stringify({web_results:e4.map(e=>({url:e,is_attachment:!0}))}):null,e5=null!=T?T:eu,e6=null==e4?void 0:e4.some(e=>(0,f._)(e).includes("image")),e7=null!==(n=e9&&!e6)&&void 0!==n&&n;eg(e7),e7||ey(null);let te=ei(eX,null!=E&&E,null!=eV?eV:null,null!=ek?ek:null),tt=(0,U.cH)();(0,j.YJ)();let ti=!!te,tn=W({defaultSources:eu,sourcesOverride:T,isFollowup:ti,existingFrontendContextUUID:eU,firstResult:eh}),tl=V({defaultFocus:es,focusOverride:C,currentSources:eu,isFollowup:ti,existingFrontendContextUUID:eU,firstResult:eh,isAssistantSwitcher:ed}),tr=z({recencyFromContext:ea,isFollowup:ti,existingFrontendContextUUID:eU,firstResult:eh}),to=E?{title:null!==(l=null==eV?void 0:eV.article_info.title)&&void 0!==l?l:null==eh?void 0:eh.query_str,url_slug:null!==(r=null==eV?void 0:eV.thread_url_slug)&&void 0!==r?r:null==eh?void 0:eh.thread_url_slug,mode:null===(t=null!==(o=null==eV?void 0:eV.mode)&&void 0!==o?o:null==eh?void 0:eh.mode)||void 0===t?void 0:t.toUpperCase()}:void 0,ts=H&&(0,p.o2)(H.user_permission)?c.i.collectionToSchematized(H):void 0,tu=er.getRenderingPlace(),ta=null!=tu,td={parent_info:void 0,plan:void 0,summary:void 0,form:void 0,reasoning_plan:void 0,status:y.nW.PENDING,final:!1,query_str:e$,backend_uuid:eX?"":null!=D?D:"",bookmark_state:H?y.wm.BOOKMARKED:y.wm.NOT_BOOKMARKED,context_uuid:"",frontend_context_uuid:null!==(s=null!=eq?eq:eU)&&void 0!==s?s:"",uuid:null!=R?R:e0,...E?{parent_info:to}:{},author_username:void 0,author_image:void 0,search_focus:tl,search_recency_filter:null!=tr?tr:void 0,sources:e5?{sources:e5}:void 0,num_sources_display:void 0,display_model:e9&&!e7?eE:null!=e8?e8:eE,personalized:ex,attachments:e4,blocks:[],social_info:{like_count:0,view_count:0,fork_count:0,user_likes:!1},mode:e3?h.y9.COPILOT:h.y9.CONCISE,text:null!=e2?e2:void 0,collection_info:ts,is_related_query_result:null!=Z&&Z,related_queries:[],media_items:[],widget_data:[],widget_intents:[],knowledge_cards:[],sponsored_results:[],expect_sponsored_results:!1,related_query_items:[],sources_list:[],answer_modes:[],is_nav_suggestions_disabled:eH||"sidecar"===tu,structured_answer_block_usages:[]};eq?I.setQueryData(["results"],()=>[td]):I.setQueryData(["results"],e=>{if(!e||!eU){let t="[submitQuery] Attempt to add new result to existing thread failed. Thread could not be found frontend_context_uuid=".concat(eq,"}]");return v.v.log(t),e}return D?eB?e:e.map(e=>(null==e?void 0:e.backend_uuid)===D?td:e):e.concat({...td,frontend_context_uuid:eU})});let tc=await er.getSystemInfo().catch(a.A),t_=ta?{source:m.o8,client_payload_cache_key:e1}:{},tp=P({inPage:null!=A?A:eT}),tm=tp&&!b.startsWith("> ".concat(tp,"\n\n"))?"> ".concat(tp,"\n\n").concat(b):b,tf={last_backend_uuid:te,read_write_token:eX?void 0:eb,existing_entry_uuid:eX?void 0:D,deleted_urls:N,attachments:e4,language:(0,g.th)(),timezone:g.GI,in_page:null!=A?A:eT,in_domain:ew,search_focus:tl,sources:tn,search_recency_filter:tr,frontend_uuid:null!=R?R:e0,redo_search:B,mode:e3?"copilot":"concise",target_collection_uuid:null==H?void 0:H.uuid,model_preference:e8,is_related_query:null!=Z&&Z,is_sponsored:null!=Y&&Y,related_query_uuid:et,visitor_id:tt,user_nextauth_id:null==X?void 0:null===(i=X.user)||void 0===i?void 0:i.id,frontend_context_uuid:eq,prompt_source:eF,query_source:"sidecar"===tu?"sidecar":eQ,is_incognito:eN,time_from_first_type:eW,use_schematized_api:!0,send_back_text_in_streaming_api:!1,supported_block_use_cases:["media_items","knowledge_cards","inline_place_cards","place_widgets"],utm_source:ez,step_payload:eK,client_coordinates:eY,is_nav_suggestions_disabled:eH||"sidecar"===tu,..."followup"===eQ?{followup_source:"link"}:{},...t_,...eG?{disable_widgets:eG}:{}};if(!(e$.length<=35)||e3||ti||0!==e4.length||"internet"!==tl||"sidecar"===tu||(ta&&["new_tab","split_view"].includes(tu)?er.injectSearchResults(tm):(0,S.z$)({query:tm,language:tf.language,queryClient:I})),ti&&ta&&er.resetNavigationResults(),null==O?void 0:O.disconnected){O.connect();let e=performance.now();v.v.log("Started opening connection to socket",{startTime:e}),await K(O,1e4,e),v.v.log("Socket connected",{itTook:performance.now()-e})}(null==O?void 0:O.disconnected)?(v.v.log("Still disconnected, reporting"),(0,x.KN)(!O,null===(u=null==O?void 0:O.disconnected)||void 0===u||u)):O&&x.sV.submitQuery({name:"perplexity_ask",queryStr:tm,queryParams:tf,isFollowup:ti,isPerplexityBrowser:!!ta,frontendUUID:null==tf?void 0:tf.frontend_uuid,socket:O,session:null,browserVersion:null!==(d=null==tc?void 0:tc.browserVersion)&&void 0!==d?d:null}),ta&&q({query:tm,inPage:null!=A?A:eT,clientPayloadCacheKey:e1,entropyBrowser:er});let tg=performance.now(),tv=await (null==O?void 0:O.emitWithAck("perplexity_ask",tm,tf));if(tv){let e=performance.now()-tg;"default_search"===tf.query_source&&eJ?F(eJ):(0,x.lF)(e,!0,e3,e9),ej(tv),ee({socket:O,response:tv,isUserLoggedIn:eR,submissionCount:eP,session:X,queryCountMobile:eC,isProUser:en,locale:el,queryCount:eA,addKeyRequiringRerender:eI,getEppoBooleanVariation:eO,setSubmissionCount:eM,setShouldShowProductFeedback:eS,trackEvent:Q}),null==eD||eD(tv),H&&I.invalidateQueries({queryKey:[k.d8,{collection_slug:H.slug.slice(-22)}]});let t=!!E||!ti,i=I.getQueryData(["results"]);if((null==i?void 0:i[0].frontend_context_uuid)!==tv.frontend_context_uuid)return;if((null==tv?void 0:tv.thread_title)&&(document.title=tv.thread_title),(null==tv?void 0:tv.thread_url_slug)&&t){let e=null==tv?void 0:tv.thread_url_slug;eI("floating-signup"),I.setQueryData(["slug-to-frontendContextUUID"],t=>({...t,[e]:eq})),"/search/new"===window.location.pathname&&((0,$.C)({slug:e,searchParams:M}),await I.invalidateQueries({queryKey:[w.j],refetchType:"all"}))}if(O&&X){O.emit("get_rate_limit",{},e=>{var t;let i=null!==(t=e.remaining)&&void 0!==t?t:0;ep>0&&null!==e.remaining&&i<=0&&Q("pro rate limit reached",{}),em(i),i<=0&&(e_(!1),eL({default_copilot:!1}))}),O.emit("get_reasoning_rate_limit",{},e=>{var t;let i=null!==(t=e.remaining)&&void 0!==t?t:0;ef(i),i<=0&&eg(!1)});return}}},[eo,eR,ec,eu,ek,eh,es,ed,ea,eE,ex,er,eb,X,eN,O,eP,eI,I,ej,eC,en,el,eA,eO,Q,M,ep,em,e_,eL,ef,eg,ev,ey]),eQ=(0,l.useCallback)((e,t)=>{var i;H({result:e,step:t,socket:O,user_id:null==X?void 0:null===(i=X.user)||void 0===i?void 0:i.id,lastEntryUUID:null==ek?void 0:ek.backend_uuid,queryClient:I,handleProgressResponse:eq,handleFinalResponse:ej,deviceLocation:eo})},[ej,eq,null==ek?void 0:ek.backend_uuid,I,null==X?void 0:X.user,O,eo]),eV=(0,l.useCallback)(e=>{let{task:t,startURL:i,uuid:n,extra_headers:l}=e;er.submitTask({task:t,startURL:i,uuid:n,extra_headers:l},(e,i,l)=>{var r,o;eF({rawQuery:null!==(r=null==ek?void 0:ek.query_str)&&void 0!==r?r:"",existingEntryUUID:null==ek?void 0:ek.backend_uuid,existingUuid:null!==(o=null==ek?void 0:ek.uuid)&&void 0!==o?o:void 0,redoSearch:!1,collection:null!=ew?ew:null,existingFrontendContextUUID:null==ek?void 0:ek.frontend_context_uuid,newFrontendContextUUID:null,promptSource:null,querySource:m.o8,stepPayload:{step_type:"ENTROPY_RESULTS",content:{goal_id:t,result:{message:e,url:i,extra_headers:l}},uuid:n},preserveMessageState:!0})})},[er,ek,ew,eF]);(0,l.useEffect)(()=>(null==O||O.on("launch_entropy_task",eV),()=>{null==O||O.off("launch_entropy_task",eV)}),[O,eV]);let eW=(0,l.useCallback)(()=>{null!=ek&&ek.backend_uuid&&(null==ek?void 0:ek.backend_uuid)!==eD||(Q("delete last result",{entryUUID:eD}),null==O||O.emit("delete_ask_entry",null==ek?void 0:ek.backend_uuid,{read_write_token:eb},()=>{I.setQueryData(["results"],e=>{if(!e)return;let t=null!=e?e:[];if(t.length<1){N.push("/");return}return t.slice(0,-1)})}))},[Q,eD,I,O,null==ek?void 0:ek.backend_uuid,eb,N]);return(0,n.jsx)(et.Provider,{value:{submitQuery:eF,handleBotStep:eQ,deleteLastResult:eW,shouldShowProductFeedback:eT},children:t})},el=()=>{let e=(0,l.useContext)(et);if(!e)throw Error("usePerplexityQueryState must be used within PerplexityQueryStateContext");return e}},89708:(e,t,i)=>{i.d(t,{C:()=>l});var n=i(83401);let l=e=>{let{slug:t,searchParams:i}=e,l=new URLSearchParams(Object.fromEntries(n.RB.map(e=>[e,null==i?void 0:i.get(e)]).filter(e=>{let[t,i]=e;return null!=i}))),r=new URL(window.location.href);r.pathname="/search/".concat(t),r.search=l.toString();let o=r.toString();window.history.replaceState(null,"",o)}},31780:(e,t,i)=>{i.d(t,{c:()=>f,y:()=>v});var n=i(43453),l=i(98505),r=i(49745),o=i(27299),s=i(47303),u=i(34025),a=i(96298),d=i(92455),c=i(75716),_=i(98762);let p={isCopilot:!1,focus:"internet",sources:[],gpt4Limit:0,gpt4Total:0,opusLimit:0,proReasoningLimit:0,uploadRateLimit:0,createLimit:0,recency:null,askInputReasoningMode:!1,askInputReasoningModelPreference:null,isAssistantSwitcher:!1,setAskInputReasoningMode:()=>{},setAskInputReasoningModelPreference:()=>{},setFocus:()=>{},setSources:()=>{},addSource:()=>{},removeSource:()=>{},setIsCopilot:()=>{},decrementCreateLimit:()=>{},setGPT4Limit:()=>{},setOpusLimit:()=>{},setProReasoningLimit:()=>{},focusOverride:null,setFocusOverride:()=>{},sourcesOverride:null,setSourcesOverride:()=>{},clearFocusAndSourcesOverrides:()=>{},setRecency:()=>{},setIsAssistantSwitcher:()=>{},setUploadRateLimit:()=>{}},m=(0,l.createContext)(p),f=e=>{let{children:t,shouldFetchSettings:i}=e,f=(0,d.u)(i),{updateSettings:v}=(0,a.t)(),{setPreferredSearchMode:y}=(0,c.oB)(),h=(0,o.p)(),k=(0,c.ab)(),b={},w=!!k&&Object.values(_.k0).includes(k);if(w){b.isCopilot=k!==_.k0.DEFAULT;let e=!!k&&[_.k0.R1,_.k0.O1,_.k0.O3_MINI].includes(k);b.askInputReasoningMode=e,b.askInputReasoningModelPreference=e?k:void 0}else{var x;b.isCopilot=null!==(x=f.defaultCopilot)&&void 0!==x&&x}let[E,A]=(0,l.useState)({...p,gpt4Limit:f.gpt4Limit,gpt4Total:f.gpt4Total,opusLimit:f.opusLimit,proReasoningLimit:f.proReasoningLimit,...b}),C=(0,u.L)(),{DEFAULT_ASSISTANTS:T}=(0,s.A)(),S=e=>null!==e&&e in r.Fb,L=(0,l.useCallback)(e=>{S(e)&&T.has(e)&&A(t=>({...t,focusOverride:e}))},[T]),D=(0,l.useCallback)(e=>{A(t=>{let i=g(e,t.focusOverride,T,t.isAssistantSwitcher);return{...t,sourcesOverride:e,focusOverride:i}})},[T]),R=(0,l.useCallback)(()=>{A(e=>({...e,sourcesOverride:null,focusOverride:null}))},[]),I=(0,l.useCallback)(e=>{S(e)&&T.has(e)&&A(t=>({...t,focus:e}))},[T]),O=(0,l.useCallback)(e=>{A(t=>{let i=g(e,t.focus,T,t.isAssistantSwitcher);return{...t,sources:e,focus:null!=i?i:"internet"}})},[T]),N=(0,l.useCallback)(e=>{A(t=>({...t,recency:e}))},[]),P=(0,l.useCallback)(e=>{A(t=>({...t,isCopilot:e}))},[]),M=(0,l.useCallback)(e=>{A(t=>({...t,askInputReasoningModelPreference:e,askInputReasoningMode:!!e}))},[]),q=(0,l.useCallback)(e=>{A(t=>({...t,askInputReasoningMode:e}))},[]);(0,l.useEffect)(()=>{_.Dn.includes(k)&&E.proReasoningLimit<=0&&(q(!1),M(null),y(_.k0.DEFAULT))},[k,f,q,M,y,E]),(0,l.useEffect)(()=>{null!==f.createLimit&&A(e=>({...e,createLimit:f.createLimit}))},[f.createLimit]),(0,l.useEffect)(()=>{f.defaultCopilot&&P(f.defaultCopilot)},[f.defaultCopilot]),(0,l.useEffect)(()=>{null!==f.uploadLimit&&A(e=>({...e,uploadRateLimit:f.uploadLimit}))},[f.uploadLimit]),(0,l.useEffect)(()=>{null!==f.gpt4Limit&&A(e=>({...e,gpt4Limit:f.gpt4Limit}))},[f.gpt4Limit]),(0,l.useEffect)(()=>{null!==f.gpt4Total&&A(e=>({...e,gpt4Total:f.gpt4Total}))},[f.gpt4Total]),(0,l.useEffect)(()=>{null!==f.opusLimit&&A(e=>({...e,opusLimit:f.opusLimit}))},[f.opusLimit]),(0,l.useEffect)(()=>{null!==f.proReasoningLimit&&A(e=>({...e,proReasoningLimit:f.proReasoningLimit}))},[f.proReasoningLimit]);let U=(0,l.useCallback)(e=>{C&&f.gpt4Limit&&f.gpt4Limit>0&&P(e)},[C,f.gpt4Limit,P]);(0,l.useEffect)(()=>{(k!==_.k0.DEFAULT&&E.gpt4Limit<=0||!C)&&(U(!1),y(_.k0.DEFAULT))},[k,f.gpt4Limit,f.hasLoadedSettings,U,y,E.gpt4Limit,C]),(0,l.useEffect)(()=>{w&&k&&(null==h?void 0:h.includes(k))&&(U(!1),M(null),y(_.k0.DEFAULT))},[U,w,M,h,k,y]);let j=(0,l.useCallback)(()=>{let e=Math.max(E.createLimit-1,0);v({create_limit:e}),A(t=>({...t,createLimit:e}))},[E.createLimit,v]),F=(0,l.useCallback)(()=>{let e=Math.max(E.uploadRateLimit-1,0);v({upload_limit:e}),A(t=>({...t,uploadRateLimit:e}))},[E.uploadRateLimit,v]),Q=(0,l.useCallback)(e=>{A(t=>({...t,gpt4Limit:e})),v({gpt4_limit:e})},[v]),V=(0,l.useCallback)(e=>{A(t=>({...t,gpt4Total:e})),v({gpt4_total:e})},[v]),W=(0,l.useCallback)(e=>{A(t=>({...t,opusLimit:e})),v({opus_limit:e})},[v]),z=(0,l.useCallback)(e=>{A(t=>({...t,proReasoningLimit:e})),v({pro_reasoning_limit:e})},[v]),K=(0,l.useCallback)(e=>{A(t=>({...t,isAssistantSwitcher:e}))},[]),B={...E,isCopilot:k!==_.k0.DEFAULT,focus:E.focus,sources:E.sources,focusOverride:E.focusOverride,sourcesOverride:E.sourcesOverride,setFocus:I,setSources:O,setFocusOverride:L,setSourcesOverride:D,clearFocusAndSourcesOverrides:R,setIsCopilot:U,decrementCreateLimit:j,setUploadRateLimit:F,setGPT4Limit:Q,setGPT4Total:V,setOpusLimit:W,setProReasoningLimit:z,setRecency:N,setAskInputReasoningMode:q,setAskInputReasoningModelPreference:M,setIsAssistantSwitcher:K};return(0,n.jsx)(m.Provider,{value:B,children:t})},g=(e,t,i,n)=>{if(n)return t;let l=(null==e?void 0:e.length)===0?"writing":"internet";return i.has(l)?l:t},v=()=>{let e=(0,l.useContext)(m);if(!e)throw Error("useThreadConfig must be used within ThreadSettingsContext");return e}},36545:(e,t,i)=>{i.d(t,{d:()=>n});let n="DEFAULT_SEARCH_PLACEHOLDER"},82940:(e,t,i)=>{i.d(t,{$:()=>o});var n=i(98505),l=i(82945),r=i(32848);let o=()=>{let[e,t]=(0,r.Mj)("deviceLocation",null),i=(0,n.useCallback)(e=>{t(e),e?(l.A.set("lat",e.latitude.toString()),l.A.set("long",e.longitude.toString())):(l.A.remove("lat"),l.A.remove("long"))},[t]),[o,s]=(0,n.useState)(null);return(0,n.useEffect)(()=>{if(!navigator.geolocation||!("permissions"in navigator))return;let e=()=>{navigator.geolocation.getCurrentPosition(e=>{i({latitude:e.coords.latitude,longitude:e.coords.longitude})},null,{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})};navigator.permissions.query({name:"geolocation"}).then(t=>{s(t.state),"granted"===t.state?e():i(null),t.addEventListener("change",()=>{s(t.state),"denied"===t.state?i(null):"granted"===t.state&&e()})}).catch(()=>{})},[i]),{location:e,permissionStatus:o}}},21993:(e,t,i)=>{i.d(t,{G:()=>u,Q:()=>s});var n=i(43453),l=i(98505);let r={message:null,variant:"success",isVisible:!1,openToast:()=>void 0,closeToast:()=>void 0},o=(0,l.createContext)(r),s=e=>{let{children:t}=e,[i,s]=(0,l.useState)(r),u=(0,l.useCallback)((e,t,i)=>{s(n=>({...n,message:e,variant:t,timeout:i,isVisible:!0}))},[]),a=(0,l.useCallback)(()=>{s(e=>({...e,isVisible:!1}))},[]),d=(0,l.useMemo)(()=>({...i,openToast:u,closeToast:a}),[u,a,i]);return(0,n.jsx)(o.Provider,{value:d,children:t})},u=()=>{let e=(0,l.useContext)(o);if(!e)throw Error("useToastState must be used within ToastContext");return e}},68876:(e,t,i)=>{i.d(t,{$I:()=>p,GO:()=>m,Jo:()=>g,KK:()=>o,QK:()=>_,Qt:()=>f,Qz:()=>n,WH:()=>u,ZW:()=>l,gl:()=>a,o2:()=>d,qX:()=>c,u8:()=>s,uU:()=>r,yO:()=>v});let n=5;var l=(e=>(e[e.NONE=0]="NONE",e[e.READER=1]="READER",e[e.WRITER=2]="WRITER",e[e.EDITOR=5]="EDITOR",e[e.ADMIN=3]="ADMIN",e[e.OWNER=4]="OWNER",e[e.OWNER_DEFAULT_BOOKMARKS=6]="OWNER_DEFAULT_BOOKMARKS",e[e.INVITED_READER=11]="INVITED_READER",e[e.INVITED_WRITER=12]="INVITED_WRITER",e[e.INVITED_EDITOR=15]="INVITED_EDITOR",e[e.INVITED_ADMIN=13]="INVITED_ADMIN",e))(l||{});function r(){return[1,2,5,3,4]}function o(){return[11,12,15,13]}function s(e){return 4===e||6===e}function u(e){return 6===e}function a(e){return e>=3&&e<11&&5!==e}function d(e){return e>=2&&e<11}function c(e){return e>=1&&e<11}function _(e){return 1==e||11==e}function p(e){return 0===e}function m(e){return o().includes(e)}function f(e){let t=e.owner_user,i=e.contributor_users,n=[],l=[],r=o();return null==i||i.forEach(e=>{e.permission&&r.includes(e.permission)?n.push(e):l.push(e)}),{ownerUser:t,contributorUsers:l,invitedUsers:n}}var g=(e=>(e.PageAccessNotAllowed="pageAccessNotAllowed",e.ThreadAccessNotAllowed="threadAccessNotAllowed",e.InvalidThread="invalidThread",e.ThreadExpired="threadExpired",e.CollectionAccessNotAllowed="collectionAccessNotAllowed",e.SpaceAccessNotAllowed="spaceAccessNotAllowed",e.InvalidCollection="invalidCollection",e.SubscriptionAlreadyActive="subscriptionAlreadyActive",e))(g||{});let v="VIEW_THREAD_NOT_ALLOWED"},67522:(e,t,i)=>{i.d(t,{_:()=>n});let n=e=>{var t;let i=null==(t=e.split(".").pop())?void 0:t.toLowerCase();return i&&({png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",pdf:"application/pdf",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",txt:"text/plain",csv:"text/csv",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",md:"text/markdown"})[i]||"application/octet-stream"}}}]);
//# sourceMappingURL=43307-96cf5cd93ad591cc.js.map